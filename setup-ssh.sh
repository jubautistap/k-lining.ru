#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSH –∫–ª—é—á–µ–π
# –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ø–ª–æ–∏—Ç—å –±–µ–∑ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è

echo "üîë –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º SSH –∫–ª—é—á–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è..."

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
SERVER_HOST="80.87.201.107"
SERVER_USER="root"

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

print_status() {
    echo -e "${GREEN}[INFO]${NC} $1"
}

print_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

print_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ SSH –∫–ª—é—á–∞
if [ ! -f ~/.ssh/id_rsa ]; then
    print_status "SSH –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π..."
    ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N ""
    print_status "SSH –∫–ª—é—á —Å–æ–∑–¥–∞–Ω!"
else
    print_status "SSH –∫–ª—é—á —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç."
fi

# –ö–æ–ø–∏—Ä—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä
print_status "–ö–æ–ø–∏—Ä—É–µ–º SSH –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä..."
print_warning "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:"

ssh-copy-id -i ~/.ssh/id_rsa.pub $SERVER_USER@$SERVER_HOST

if [ $? -eq 0 ]; then
    print_status "SSH –∫–ª—é—á —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä!"
    print_status "–¢–µ–ø–µ—Ä—å –¥–µ–ø–ª–æ–π –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –ø–∞—Ä–æ–ª—è!"
else
    print_error "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ SSH –∫–ª—é—á–∞"
    exit 1
fi

# –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –ø–∞—Ä–æ–ª—è
print_status "–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –ø–∞—Ä–æ–ª—è..."
ssh -o ConnectTimeout=10 $SERVER_USER@$SERVER_HOST "echo '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –ø–∞—Ä–æ–ª—è —Ä–∞–±–æ—Ç–∞–µ—Ç!'"

if [ $? -eq 0 ]; then
    print_status "‚úÖ SSH –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"
    print_status "–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ./deploy.sh –±–µ–∑ –ø–∞—Ä–æ–ª—è!"
else
    print_error "‚ùå SSH –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å"
    exit 1
fi 